<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bigo Wallet</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="css/wallet.css">
    <!-- 引入组件库 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>
    <script>
        $(() => {
            var web3Host = '3.238.241.32',
                web3Port = '8802',
                addr = "0x8Db0d0Dd0E1571c0d22F821fde96c7AF910A0b45";
            new Vue({
                el: '#app',
                data: () => {
                    return {
                        web3: null,
                        form: {
                            address: addr,
                            gas: 21000,
                            gasPrice: 1000000000,
                            to: '0x0bD83bF0F8552c74dD0EE00911E70ab90183eDBd',
                            value: 0,
                            data: '',
                            privateKey: '0x991de187e4bebc7467e4ce2c1365be6cd74199634e356eea45018458113e4c2d'
                        },
                        formA: {
                            contract: ''
                        }
                    }
                },
                mounted: () => {
                    //connect to node
                    web3 = new Web3(new Web3.providers.HttpProvider('http://' + web3Host + ':' + web3Port));
                    if (web3.givenProvider == undefined || web3.givenProvider == null) {
                        console.error("Bigo - no conection to RPC server");
                    } else {
                        console.log("Bigo - connected to RPC server");
                    }
                    //compute the balance of the designed account
                    web3.eth.getBalance(addr, "latest", (err, balance) => {
                        let bigo = parseFloat(web3.utils.fromWei(balance, 'ether'));
                        $('#accountBalance').text(bigo);
                    });
                },
                methods: {
                    //transaction start
                    onSubmit() {
                        let tx = {
                            from: this.form.address,
                            gasPrice: this.form.gasPrice + '',
                            gas: this.form.gas + '',
                            to: this.form.to,
                            value: String(this.form.value * 1000000000000000000),
                            data: this.form.data
                        };
                        web3.eth.accounts.signTransaction(tx, this.form.privateKey, (error, signed) => {
                            if (error == null || error == undefined) {
                                web3.eth.sendSignedTransaction(signed.rawTransaction).once('sent', receipt => {
                                    this.$message({
                                        type: 'info',
                                        message: '交易发出'
                                    })
                                }).on('receipt', receipt => {
                                    this.$message({
                                        type: 'info',
                                        message: '交易成功'
                                    })
                                })
                            } else console.log(error);
                        });
                    },
                    //compute the balance of the designed account
                    balance() {
                        if (web3.utils.isAddress(this.form.address)) {
                            web3.eth.getBalance(this.form.address, "latest", (err, balance) => {
                                if (err == null) {
                                    let bigo = parseFloat(web3.utils.fromWei(balance, 'ether'));
                                    $('#accountBalance').text(bigo);
                                } else {
                                    $('#accountBalance').text('error account');
                                }
                            });
                        } else {
                            $('#accountBalance').text('error account');
                        }
                    }
                }
            });
        });
    </script>
</head>

<body>
    <el-container id="app">
        <el-header>
            wallet
        </el-header>
        <el-container>
            <el-main>
                <div class="input">
                    <el-container>
                        <el-main>
                            <el-form ref="form" :model="form" label-width="80px">
                                <el-form-item label="账户地址">
                                    <el-input v-model="form.address" @blur="balance"></el-input>
                                </el-form-item>
                                <el-form-item label="To:">
                                    <el-input v-model="form.to"></el-input>
                                </el-form-item>
                                <el-form-item label="value:">
                                    <el-input v-model="form.value"></el-input>
                                </el-form-item>
                                <el-form-item label="gasPrice(wei):">
                                    <el-col :span="11">
                                        <el-input type="number" placeholder="gas price" v-model="form.gasPrice" style="width: 100%;">
                                            </el-date-picker>
                                    </el-col>
                                    <el-col class="line" :span="2">-</el-col>
                                    <el-col :span="11">
                                        <span class="demonstration">gas</span>
                                        <el-slider v-model="form.gas" :min=21000 :max=1000000></el-slider>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="Private Key:">
                                    <el-input v-model="form.privateKey"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="onSubmit">提交交易</el-button>
                                    <el-button>取消</el-button>
                                </el-form-item>
                            </el-form>
                        </el-main>
                        <el-footer>
                            <el-form ref="formA" :model="formA" label-width="80px">
                                <el-form-item label="deploy">
                                    <el-input v-model="formA.contract"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button>部署合约</el-button>
                                </el-form-item>
                            </el-form>
                        </el-footer>
                    </el-container>
                </div>
            </el-main>
            <el-aside width="40%">
                <div class="output">
                    <div class="output_1">
                        <div>余额：</div>
                        <div id="accountBalance"></div>
                    </div>
                </div>
            </el-aside>
        </el-container>
        <el-footer></el-footer>
    </el-container>
</body>

</html>